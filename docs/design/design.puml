@startuml

' PRESENTATION 
package presentation {

  ' Views --------
  class StudentParentDashboardView {
    +showDashboard(): void
    +showError(message: String): void
  }

  class TeacherGradebookView {
    +showGradebook(): void
    +showSuccess(message: String): void
    +showError(message: String): void
  }

  class AttendanceView {
    +showAttendance(): void
    +showError(message: String): void
  }

  class HealthView {
    +showNurseVisits(): void
    +showError(message: String): void
  }

  class DisciplineView {
    +showDiscipline(): void
    +showError(message: String): void
  }

  class LoginView {
    +showLogin()
    +showLoginError(message: String): void
  }

  class DashboardController {
    -dashboardView: DashboardView
    -gradebookService: GradebookService
    -healthService: HealthService
    -disciplineService: DisciplineService
    -attendanceService: AttendanceService

    +loadStudentDashboard(studentId: String): void
    +loadParentDashboard(parentId: String): void
    +update(event: GradebookEvent): void
    +update(event: HealthEvent): void
    +update(event: DisciplineEvent): void
    +update(event: AttendanceEvent): void
  }

  class GradebookController {
    -gradebookView: TeacherGradebookView
    -gradebookService: GradebookService

    +viewGradebook(sectionId: String, teacherId: String): void
    +updateGrade(assignmentId: String, studentId: String, points: float, comment: String): void
    +addFeedback(studentId: String, sectionId: String, comment: String): void
    +update(event: GradebookEvent): void
  }

  class AttendanceController {
    -attendanceView: AttendanceView
    -attendanceService: AttendanceService

    +viewAttendance(studentId: String): void
    +markAttendance(sectionId: String, studentId: String, date: String, status: boolean): void
    +update(event: AttendanceEvent): void
  }

  class HealthController {
    -healthView: HealthView
    -healthService: HealthService

    +viewHealthVisits(studentId: String): void
    +recordVisit(studentId: String, nurseId: String, notes: String): void
    +update(event: HealthEvent): void
  }

  class DisciplineController {
    -disciplineView: DisciplineView
    -disciplineService: DisciplineService

    +viewDiscipline(studentId: String): void
    +recordDiscipline(studentId: String, adminId: String, action: String, notes: String): void
    +update(event: DisciplineEvent): void
  }

  class AuthController {
    -loginView: LoginView
    -authService: AuthService

    +login(username: String, password: String): void
    +logout(): void
    +update(event: AuthEvent): void
  }
}

' DOMAIN 
package domain {
  +abstract class Record {
    -id: String
    +getById(): String
    {abstract}+toMap(): Map
  }
  ' Core Users / Roles 
  +class User {
    -id: String
    -username: String
    -passwordHash: String
    -role: UserType

    +getId(): String
    +getUsername(): String
    +getRole(): UserType
    +toMap(): Map
  }

  class ParentStudentLink {
    -parentId: String
    -studentId: String
    +toMap(): Map
  }

  +enum UserType {
      STUDENT
      PARENT
      TEACHER
      NURSE
      ADMINISTRATOR
    }

  +class Class {
    -id: String
    -name: String
    -subject: Subject

    +getId(): String
    +getName(): String
    +getSubject(): Subject
    +setName(name: String): void
    +setSubject(subject: Subject): void
    +toMap(): Map
  }

  +enum Subject {
    MATH
    SCIENCE
    HISTORY
    ENGLISH
  }

  +class Section {
    -id: String
    -classId: String
    -teacherId: String
    -term: Term

    +getId(): String
    +getClassId(): String
    +getTeacherId(): String
    +getTerm(): Term
    +setClassId(classId: String): void
    +setTeacherId(teacherId: String): void
    +setTerm(term: Term): void
    +toMap(): Map
  }

  +enum Term {
    FALL
    WINTER
    SPRING
    SUMMER
  }

  class Enrollment {
    -studentId: String
    -sectionId: String
    +toMap(): Map
  }

  +class Assignment {
    -id: String
    -sectionId: String
    -name: String
    -maxPoints: float
    -dueDate: LocalDateTime

    +getId(): String
    +getSectionId(): String
    +getName(): String
    +getMaxPoints(): float
    +getDueDate(): LocalDateTime
    +setSectionId(sectionId: String): void
    +setName(name: String): void
    +setMaxPoints(maxPoints: float): void
    +setDueDate(dueDate: LocalDateTime): void
    +toMap(): Map
  }

  class GradeEntry {
    -id: String
    -assignmentId: String
    -studentId: String
    -points: float
    -comment: String

    +getId(): String
    +getAssignmentId(): String
    +getStudentId(): String
    +getPoints(): float
    +getComment(): String
    +setAssignmentId(assignmentId: String): void
    +setStudentId(studentId: String): void
    +setPoints(points: float): void
    +setComment(comment: String): void
    +toMap(): Map
  }

  class Feedback {
    -id: String
    -studentId: String
    -sectionId: String
    -teacherId: String
    -comment: String
    -createdAt: LocalDateTime

    +getId(): String
    +getStudentId(): String
    +getSectionId(): String
    +getTeacherId(): String
    +getComment(): String
    +getCreatedAt(): LocalDateTime
    +setStudentId(studentId: String): void
    +setSectionId(sectionId: String): void
    +setTeacherId(sectionId: String): void
    +setComment(comment: String): void
    +setCreatedAt(createdAt: LocalDateTime): void
    +toMap(): Map
  }

  class AttendanceRecord {
    -id: String
    -studentId: String
    -date: LocalDate
    -sectionId: String
    -status: AttendanceStatus
    -reason: String

    +getId(): String
    +getStudentId(): String
    +getDate(): LocalDate
    +getSectionId(): String
    +getStatus(): AttendanceStatus
    +getReason(): String
    +setStudentId(studentId): void
    +setDate(date: LocalDate): void
    +setSectionId(sectionId: String): void
    +setStatus(status: AttendanceStatus): void
    +setReason(reason: String): void
    +toMap(): Map
  }

  class NurseVisit {
    -id: String
    -studentId: String
    -visitTime: LocalDateTime
    -nurseId: String
    -notes: String

    +getId(): String
    +getStudentId(): String
    +getVisitTime(): LocalDateTime
    +getNurseId(): String
    +getNotes(): String
    +setStudentId(studentId: String): void
    +setVisitTime(date: LocalDateTime): void
    +setNurseId(nurseId: String): void
    +setNotes(notes: String): void
    +toMap(): Map
  }

  class DisciplineAction {
    -id: String
    -studentId: String
    -date: LocalDate
    -adminId: String
    -actionType: DisciplineActionType
    -notes: String

    +getId(): String
    +getStudentId(): String
    +getDate(): LocalDate
    +getAdminId(): String
    +getActionType(): DisciplineActionType
    +getNotes(): String
    +setStudentId(studentId: String): void
    +setDate(date: LocalDate): void
    +setAdminId(adminId: String): void
    +setActionType(actionType: DisciplineActionType): void
    +setNotes(notes: String): void
    +toMap(): Map
  }

  +enum AttendanceStatus {
    PRESENT
    ABSENT
  }

  +enum DisciplineActionType {
    DETENTION
    SUSPENSION
  }

  class AuthService {
    -userRepository: UserRepository

    +authenticate(username: String, password: String): boolean
    +getCurrentUser(): User

    +registerObserver(observer: Observer<AuthEvent>): void
    +removeObserver(observer: Observer<AuthEvent>): void
    +notifyObservers(event: AuthEvent): void
  }

  class GradebookService {
    -gradeRepository: GradebookAssignmentRepository
    -assignmentRepository: GradebookAssignmentRepository
    -sectionRepository: SectionRepository
    -feedbackRepository: Repository

    +getGradesForSection(sectionId: String, teacherId: String): List<GradeEntry>
    +getGradesForStudent(studentId: String)
    +updateGrade(assignmentId: String, studentId: String, points: float, comment: String): void
    +addFeedback(studentId: String, sectionId: String, comment: String, teacherId: String): void
    +getFeedback(studentId: String): List<Feedback>

    +registerObserver(observer: Observer<GradebookEvent>): void
    +removeObserver(observer: Observer<GradebookEvent>): void
    +notifyObservers(event: GradebookEvent)): void
  }

  class AttendanceService {
    -attendanceRepository: Repository

    +getAttendanceForStudent(studentId): List<AttendanceRecord>
    +markAttendance(sectionId: String, studentId: String, date: LocalDate, status: AttendanceStatus, reason: String): void

    +registerObserver(observer: Observer<AttendanceEvent>): void
    +removeObserver(observer: Observer<AttendanceEvent>): void
    +notifyObservers(event: AttendanceEvent): void
  }

  class HealthService {
    -healthRepository: Repository

    +getNurseVisits(studentId: String): List<NurseVisit>
    +recordVisit(studentId: String, nurseId: String, notes: String): void

    +registerObserver(observer: Observer<HealthEvent>): void
    +removeObserver(observer: Observer<HealthEvent>): void
    +notifyObservers(event: HealthEvent): void
  }

  class DisciplineService {
    -disciplineRepository: Repository

    +getDisciplineActions(studentId: String): List<DisciplineAction>
    +recordDisciplineAction(studentId: String, adminId: String, actionType: DisciplineActionType, notes: String): void

    +registerObserver(observer: Observer<DisciplineEvent>): void
    +removeObserver(observer: Observer<DisciplineEvent>): void
    +notifyObservers(event: DisciplineEvent): void
  }

  class HealthEvent {
    -studentId: String
    -nurseId: String
    -visitId: String
    -visitTime: LocalDateTime

    +getStudentId(): String
    +getNurseId(): String
    +getVisitId(): String
    +getVisitTIme(): LocalDateTime
  }

  class GradebookEvent {
    -studentId: String
    -teacherId: String
    -sectionId: String
    -assignmentId: String
    -feedbackId: String

    +getStudentId(): String
    +getTeacherId(): String
    +getSectionId(): String
    +getAssignmentId(): String
    +getFeedbackId(): String
  }

  class AttendanceEvent {
    -studentId: String
    -date: LocalDate
    -sectionId: String
    -status: AttendanceStatus
    -reason: String

    +getStudentId(): String
    +getDate(): LocalDate
    +getSectionId(): String
    +getStatus(): String
    +getReason(): String
  }

  class DisciplineEvent {
    -studentId: String
    -date: LocalDate
    -adminId: String
    -actionType: DisciplineActionType
    -notes: String

    +getStudentId(): String
    +getDate(): LocalDate
    +getAdminId(): String
    +getActionType(): String
    +getNotes(): Stringt
  }

  class AuthEvent {
    -loginSuccessful: boolean
    -errorMessage: String

    +getLoginSuccessful(): boolean
    +getErrorMessage(): String
  }
}

package observer {
    +interface Observable<T extends DomainEvent> {
        +registerObserver(observer: Observer<T>): void
        +removeObserver(observer: Observer<T>): void
        +notifyObservers(event: T): void
    }

    +interface Observer<T extends DomainEvent> {
        +update(event: T): void
    }

    +interface DomainEvent{
    }
}

' DATASOURCE 
package datasource {
  class SqlDatabase {
    -{static} instance: SqlDatabase
    -connection: Connection
    -connectionUrl: String
    -username: String
    -password: String

    -SqlDatabase(connectionUrl: String, username: String, password: String)
    +{static} getInstance(): SqlDatabase
    +executeQuery(sqlQuery: PreparedStatement): ResultSet
  }
  +class SqlUserRepository {
    +findByUsername(username: String): ResultSet
    +findById(id: String): ResultSet
    +save(user: Map): void
  }

  +class SqlParentStudentLinkRepository {
    +findById(parentId: String): ResultSet
    +save(parentStudentLink: Map): void
  }

  +class SqlClassRepository {
    +findById(id: String): ResultSet
    +save(myClass: Map): void
  }

  +class SqlSectionRepository {
    +findById(id: String): ResultSet
    +findByStudentId(studentId: String): ResultSet
    +findByTeacherId(teacherId: String): ResultSet
    +save(section: Map): void`
  }

  +class SqlEnrollmentRepository {
    +findById(id: String): ResultSet
    +save(enrollment: Map): void
  }

  +class SqlAssignmentRepository {
    +findById(id: String): ResultSet
    +findBySectionId(id: String): ResultSet
    +save(assignment: Map): void
  }

  +class SqlGradebookRepository {
    +findById(studentId: String): ResultSet
    +findGradesForSection(sectionId: String): ResultSet
    +save(gradeEntry: Map): void
  }

  +class SqlFeedbackRepository {
    +findById(studentId: String): ResultSet
    +save(feedback: Map): void
  }

  +class SqlAttendanceRepository {
    +findById(studentId: String): ResultSet
    +save(attendance: Map): void
  }

  +class SqlHealthRepository {
    +findById(studentId: String): ResultSet
    +save(visit: Map): void
  }

  +class SqlDisciplineRepository {
    +findById(studentId: String): ResultSet
    +save(action: Map): void
  }

  +interface Repository {
    {abstract}+findById(id: String): ResultSet
    {abstract}+save(record: Map)
  }

  +interface UserRepository {
    {abstract}+findByUsername(username: String): ResultSet
  }

  +interface GradebookAssignmentRepository {
    {abstract}+findBySectionId(id: String): ResultSet
  }

  +interface SectionRepository {
    {abstract}+findByStudentId(id: String): ResultSet
    {abstract}+findByTeacherId(id: String): ResultSet
  }
}

' ARCHITECTURE ASSOCIATIONS 

'Presentation uses Domain
DashboardController --> StudentParentDashboardView
DashboardController ..|> Observer

GradebookController --> GradebookService
GradebookController --> TeacherGradebookView
GradebookController ..|> Observer
GradebookController ..> GradebookEvent
GradebookController ..> GradeEntry
GradebookController ..> Assignment
GradebookController ..> Feedback
GradebookController ..> Class
GradebookController ..> Section


AttendanceController --> AttendanceService
AttendanceController --> AttendanceView
AttendanceController ..|> Observer
AttendanceController ..> AttendanceRecord
AttendanceController ..> AttendanceEvent

HealthController --> HealthService
HealthController --> HealthView
HealthController ..|> Observer
HealthController ..> NurseVisit
HealthController ..> HealthEvent

DisciplineController --> DisciplineService
DisciplineController --> DisciplineView
DisciplineController ..|> Observer
DisciplineController ..> DisciplineAction
DisciplineController ..> DisciplineEvent

AuthController --> LoginView
AuthController --> AuthService
AuthController ..> User
AuthController ..> AuthEvent

AuthService ..|> Observable
AuthService --> UserRepository
AuthService ..> User
AuthService ..> AuthEvent

GradebookService ..|> Observable
GradebookService -->"*" GradebookAssignmentRepository
GradebookService --> SectionRepository
GradebookService --> Repository
GradebookService ..> GradeEntry
GradebookService ..> Assignment
GradebookService ..> Feedback
GradebookService ..> Section
GradebookService ..> Class
GradebookService ..> GradebookEvent

AttendanceService ..|> Observable
AttendanceService --> Repository
AttendanceService ..> AttendanceRecord
AttendanceService ..> AttendanceEvent

HealthService ..|> Observable
HealthService --> Repository
HealthService ..> NurseVisit
HealthService ..> HealthEvent

DisciplineService ..|> Observable
DisciplineService --> Repository
DisciplineService ..> DisciplineAction
DisciplineService ..> DisciplineEvent

User --> UserType
Class --> Subject
Section --> Term
AttendanceRecord --> AttendanceStatus
DisciplineAction --> DisciplineActionType

User --|> Record
Assignment --|> Record
GradeEntry --|> Record
Section --|> Record
Class --|> Record
Feedback --|> Record
AttendanceRecord --|> Record
NurseVisit --|> Record
DisciplineAction --|> Record
Enrollment --|> Record
ParentStudentLink --|> Record

HealthEvent ..|> DomainEvent

GradebookEvent ..|> DomainEvent

DisciplineEvent ..|> DomainEvent

AttendanceEvent ..|> DomainEvent

AuthEvent ..|> DomainEvent

GradebookAssignmentRepository --|> Repository
SectionRepository --|> Repository
UserRepository --|> Repository

SqlUserRepository ..|> UserRepository
SqlUserRepository ..> SqlDatabase

SqlFeedbackRepository ..|> Repository
SqlFeedbackRepository ..> SqlDatabase

SqlAttendanceRepository ..|> Repository
SqlAttendanceRepository ..> SqlDatabase

SqlHealthRepository ..|> Repository
SqlHealthRepository ..> SqlDatabase

SqlDisciplineRepository ..|> Repository
SqlDisciplineRepository ..> SqlDatabase

SqlParentStudentLinkRepository ..|> Repository
SqlParentStudentLinkRepository ..> SqlDatabase

SqlEnrollmentRepository ..|> Repository
SqlEnrollmentRepository ..> SqlDatabase

SqlClassRepository ..|> Repository
SqlClassRepository ..> SqlDatabase

SqlSectionRepository ..|> SectionRepository
SqlSectionRepository ..> SqlDatabase

SqlGradebookRepository ..|> GradebookAssignmentRepository
SqlGradebookRepository ..> SqlDatabase

SqlAssignmentRepository ..|> GradebookAssignmentRepository
SqlAssignmentRepository ..> SqlDatabase
@enduml
