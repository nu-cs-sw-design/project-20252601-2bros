@startuml

' PRESENTATION 
package presentation {

  ' Views --------
  class StudentParentDashboardView {
    +showDashboard(vm)
    +showError(message)
  }

  class TeacherGradebookView {
    +showGradebook(vm)
    +showSuccess(message)
    +showError(message)
  }

  class AttendanceView {
    +showAttendance(vm)
    +showError(message)
  }

  class HealthView {
    +showHealth(vm)
    +showError(message)
  }

  class DisciplineView {
    +showDiscipline(vm)
    +showError(message)
  }

  class LoginView {
    +showLogin()
    +showLoginError(message)
  }

  '  Controllers (MVC)
  class DashboardController {
    -dashboardView: DashboardView

    +loadStudentDashboard(studentId)
    +loadParentDashboard(parentId)
  }

  class GradebookController {
    -gradebookView: TeacherGradebookView
    -gradebookService: GradebookService

    +viewGradebook(sectionId, teacherId)
    +updateGrade(assignmentId, studentId, points, comment)
    +addFeedback(studentId, sectionId, comment)
  }

  class AttendanceController {
    -attendanceView: AttendanceView
    -attendanceService: AttendanceService

    +viewAttendance(studentId)
    +markAttendance(sectionId, studentId, date, status)
  }

  class HealthController {
    -healthView: HealthView
    -healthService: HealthService

    +viewHealthVisits(studentId)
    +recordVisit(studentId, nurseId, notes)
  }

  class DisciplineController {
    -disciplineView: DisciplineView
    -disciplineService: DisciplineService

    +viewDiscipline(studentId)
    +recordDiscipline(studentId, adminId, action, notes)
  }

  class AuthController {
    -loginView: LoginView

    +login(username, password)
    +logout()
  }

  +interface Observer {
    +update(): void
  }
}

' DOMAIN 
package domain {
  +abstract class Record {
    -id: String
    +getById(): String
    {abstract}+toMap(): Map
  }
  ' Core Users / Roles 
  +class User {
    -id: String
    -username: String
    -passwordHash: String
    -role: UserType

    +getId(): String
    +getUsername(): String
    +getRole(): UserType
    +toMap(): Map
  }

  class ParentStudentLink {
    -parentId: String
    -studentId: String
    +toMap(): Map
  }

  +enum UserType {
      STUDENT
      PARENT
      TEACHER
      NURSE
      ADMINISTRATOR
    }

  ' School Structure 
  +class Class {
    -id: String
    -name: String
    -subject: Subject

    +getId(): String
    +getName(): String
    +getSubject(): Subject
    +setName(name: String): void
    +setSubject(subject: Subject): void
    +toMap(): Map
  }

  +enum Subject {
    MATH
    SCIENCE
    HISTORY
    ENGLISH
  }

  +class Section {
    -id: String
    -classId: String
    -teacherId: String
    -term: Term

    +getId(): String
    +getClassId(): String
    +getTeacherId(): String
    +getTerm(): Term
    +setClassId(classId: String): void
    +setTeacherId(teacherId: String): void
    +setTerm(term: Term): void
    +toMap(): Map
  }

  +enum Term {
    FALL
    WINTER
    SPRING
    SUMMER
  }

  class Enrollment {
    -studentId: String
    -sectionId: String
    +toMap(): Map
  }

  ' Grades & Feedback 
  +class Assignment {
    -id: String
    -sectionId: String
    -name: String
    -maxPoints: float
    -dueDate: LocalDateTime

    +getId(): String
    +getSectionId(): String
    +getName(): String
    +getMaxPoints(): float
    +getDueDate(): LocalDateTime
    +setSectionId(sectionId: String): void
    +setName(name: String): void
    +setMaxPoints(maxPoints: float): void
    +setDueDate(dueDate: LocalDateTime): void
    +toMap(): Map
  }

  class GradeEntry {
    -id: String
    -assignmentId: String
    -studentId: String
    -points: float
    -comment: String

    +getId(): String
    +getAssignmentId: String
    +getStudentId(): String
    +getPoints: float
    +getComment(): String
    +setAssignmentId(assignmentId: String): void
    +setStudentId(studentId: String): void
    +setPoints(points: float): void
    +setComment(comment: String): void
    +toMap(): Map
  }

  class Feedback {
    -id: String
    -studentId: String
    -sectionId: String
    -teacherId: String
    -comment: String
    -createdAt: LocalDateTime

    +getId(): String
    +getStudentId(): String
    +getSectionId(): String
    +getTeacherId(): String
    +getComment(): String
    +getCreatedAt(): LocalDateTime
    +setStudentId(studentId: String): void
    +setSectionId(sectionId: String): void
    +setTeacherId(sectionId: String): void
    +setComment(comment: String): void
    +setCreatedAt(createdAt: LocalDateTime): void
    +toMap(): Map
  }

  ' Attendance / Health / Discipline
  class AttendanceRecord {
    -id: String
    -studentId: String
    -date: LocalDate
    -sectionId: String
    -status: AttendanceStatus
    -reason: String

    +getId(): String
    +getStudentId(): String
    +getDate(): LocalDate
    +getSectionId(): String
    +getStatus(): AttendanceStatus
    +getReason(): String
    +setStudentId(studentId): void
    +setDate(date: LocalDate): void
    +setSectionId(sectionId: String): void
    +setStatus(status: AttendanceStatus): void
    +setReason(reason: String): void
    +toMap(): Map
  }

  class NurseVisit {
    -id: String
    -studentId: String
    -visitTime: LocalDateTime
    -nurseId: String
    -notes: String

    +getId(): String
    +getStudentId(): String
    +getVisitTime(): LocalDateTime
    +getNurseId(): String
    +getNotes(): String
    +setStudentId(studentId: String): void
    +setVisitTime(date: LocalDateTime): void
    +setNurseId(nurseId: String): void
    +setNotes(notes: String): void
    +toMap(): Map
  }

  class DisciplineAction {
    -id: String
    -studentId: String
    -date: LocalDate
    -adminId: String
    -actionType: DisciplineActionType
    -notes: String

    +getId(): String
    +getStudentId(): String
    +getDate(): LocalDate
    +getAdminId(): String
    +getActionType(): DisciplineActionType
    +getNotes(): String
    +setStudentId(studentId: String): void
    +setDate(date: LocalDate): void
    +setAdminId(adminId: String): void
    +setActionType(actionType: DisciplineActionType): void
    +setNotes(notes: String): void
    +toMap(): Map
  }

  +enum AttendanceStatus {
    PRESENT
    ABSENT
  }

  +enum DisciplineActionType {
    DETENTION
    SUSPENSION
  }

  ' Domain Services 
  class AuthService {
    -userRepository: UserRepository

    +authenticate(username, password)
    +getCurrentUser()
  }

  class GradebookService {
    -gradeRepository: GradebookAssignmentRepository
    -assignmentRepository: GradebookAssignmentRepository
    -sectionRepository: SectionRepository
    -feedbackRepository: Repository

    +getGradebookForSection(sectionId, teacherId)
    +updateGrade(assignmentId, studentId, points, comment)
    +addFeedback(studentId, sectionId, comment, teacherId)
    +getGradesForStudent(studentId)
  }

  class AttendanceService {
    -attendanceRepository: Repository

    +getAttendanceForStudent(studentId)
    +markAttendance(sectionId, studentId, date, status, reason)
  }

  class HealthService {
    -healthRepository: Repository

    +getHealthVisits(studentId)
    +recordVisit(studentId, nurseId, notes)
  }

  class DisciplineService {
    -disciplineRepository: Repository

    +getDiscipline(studentId)
    +recordDiscipline(studentId, adminId, actionType, notes)
  }

  class DashboardService {
    -gradeRepository: GradebookAssignmentRepository
    -assignmentRepository: GradebookAssignmentRepository
    -sectionRepository: SectionRepository
    -feedbackRepository: Repository
    -attendanceRepository: Repository
    -healthRepository: Repository
    -disciplineRepository: Repository

    +buildDashboardForStudent(studentId)
    +buildDashboardForParent(parentId)
  }

  +interface Observable {
    +registerObserver(): void
    +removeObserver(): void
    +notifyObservers(): void
  }
}

' DATASOURCE 
package datasource {
  class SqlDatabase {
    -{static} instance: SqlDatabase
    -connection: Connection
    -connectionUrl: String
    -username: String
    -password: String

    -SqlDatabase(connectionUrl: String, username: String, password: String)
    +{static} getInstance(): SqlDatabase
    +executeQuery(sqlQuery: PreparedStatement): ResultSet
  }
  +class SqlUserRepository {
    +findByUsername(username: String): ResultSet
    +findById(id: String): ResultSet
    +save(user: Record): void
  }

  +class SqlParentStudentLinkRepository {
    +findById(parentId: String): ResultSet
    +save(parentStudentLink: Record): void
  }

  +class SqlClassRepository {
    +findById(id: String): ResultSet
    +save(myClass: Record): void
  }

  +class SqlSectionRepository {
    +findById(id: String): ResultSet
    +findByStudentId(studentId: String): ResultSet
    +findByTeacherId(teacherId: String): ResultSet
    +save(section: Record): void`
  }

  +class SqlEnrollmentRepository {
    +findById(id: String): ResultSet
    +save(enrollment: Record): void
  }

  +class SqlAssignmentRepository {
    +findById(id: String): ResultSet
    +findBySectionId(id: String): ResultSet
    +save(assignment: Record): void
  }

  +class SqlGradebookRepository {
    +findById(studentId: String): ResultSet
    +findGradesForSection(sectionId: String): ResultSet
    +save(gradeEntry: Record): void
  }

  +class SqlFeedbackRepository {
    +findById(studentId: String): ResultSet
    +save(feedback: Record): void
  }

  +class SqlAttendanceRepository {
    +findById(studentId: String): ResultSet
    +save(attendance: Record): void
  }

  +class SqlHealthRepository {
    +findById(studentId: String): ResultSet
    +save(visit: Record): void
  }

  +class SqlDisciplineRepository {
    +findById(studentId: String): ResultSet
    +save(action: Record): void
  }

  +interface Repository<T extends Record> {
    {abstract}+findById(id: String): ResultSet
    {abstract}+save(record: T)
  }

  +interface UserRepository {
    {abstract}+findByUsername(username: String): ResultSet
  }

  +interface GradebookAssignmentRepository {
    {abstract}+findBySectionId(id: String): ResultSet
  }

  +interface SectionRepository {
    {abstract}+findByStudentId(id: String): ResultSet
    {abstract}+findByTeacherId(id: String): ResultSet
  }
}

' ARCHITECTURE ASSOCIATIONS 

'Presentation uses Domain
'DashboardController --> DashboardService
DashboardController --> StudentParentDashboardView
DashboardController ..|> Observer

'GradebookController --> GradebookService
GradebookController --> TeacherGradebookView
GradebookController ..|> Observer

'AttendanceController --> AttendanceService
AttendanceController --> AttendanceView
AttendanceController ..|> Observer

'HealthController --> HealthService
HealthController --> HealthView
HealthController ..|> Observer

'DisciplineController --> DisciplineService
DisciplineController --> DisciplineView
DisciplineController ..|> Observer

AuthController ..> AuthService
LoginView ..> AuthController

'Domain uses Datasource
AuthService ..|> Observable
AuthService --> UserRepository
AuthService ..> User

DashboardService -->"*" Repository
DashboardService -->"*" GradebookAssignmentRepository
DashboardService --> SectionRepository

GradebookService ..|> Observable
GradebookService -->"*" GradebookAssignmentRepository
GradebookService --> SectionRepository
GradebookService --> Repository
GradebookService ..> GradeEntry
GradebookService ..> Assignment
GradebookService ..> Feedback
GradebookService ..> Section
GradebookService ..> Class

AttendanceService ..|> Observable
AttendanceService --> Repository
AttendanceService ..> AttendanceRecord

HealthService ..|> Observable
HealthService --> Repository
HealthService ..> NurseVisit

DisciplineService ..|> Observable
DisciplineService --> Repository
DisciplineService ..> DisciplineAction

User --> UserType
Class --> Subject
Section --> Term
AttendanceRecord --> AttendanceStatus
DisciplineAction --> DisciplineActionType

User --|> Record
Assignment --|> Record
GradeEntry --|> Record
Section --|> Record
Class --|> Record
Feedback --|> Record
AttendanceRecord --|> Record
NurseVisit --|> Record
DisciplineAction --|> Record
Enrollment --|> Record
ParentStudentLink --|> Record

GradebookAssignmentRepository --|> Repository
SectionRepository --|> Repository
UserRepository --|> Repository

SqlUserRepository ..|> UserRepository
SqlUserRepository ..> SqlDatabase

SqlFeedbackRepository ..|> Repository
SqlFeedbackRepository ..> SqlDatabase

SqlAttendanceRepository ..|> Repository
SqlAttendanceRepository ..> SqlDatabase

SqlHealthRepository ..|> Repository
SqlHealthRepository ..> SqlDatabase

SqlDisciplineRepository ..|> Repository
SqlDisciplineRepository ..> SqlDatabase

SqlParentStudentLinkRepository ..|> Repository
SqlParentStudentLinkRepository ..> SqlDatabase

SqlEnrollmentRepository ..|> Repository
SqlEnrollmentRepository ..> SqlDatabase

SqlClassRepository ..|> Repository
SqlClassRepository ..> SqlDatabase

SqlSectionRepository ..|> SectionRepository
SqlSectionRepository ..> SqlDatabase

SqlGradebookRepository ..|> GradebookAssignmentRepository
SqlGradebookRepository ..> SqlDatabase

SqlAssignmentRepository ..|> GradebookAssignmentRepository
SqlAssignmentRepository ..> SqlDatabase

Repository ..> Record
@enduml
